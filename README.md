# Скрипт для массового добавления хостов в zabbix из таблиц `.xlsx`

## Подготовка и использование скрипта:
Для использования скрипта требуется создать API токен в zabbix
Пользователь должен обладать правами для создания хостов и на чтение групп хостов и шаблонов

<details>
<summary><b>Создание токена</b></summary>
В веб интерфейсе zabbix перейдите в User settings (нижний левый угол) -> API tokens. В верхнем преавом углу нажмите <code>Create API token</code>. Введите имя токена, описание и дату истечения. Далее скопируйте и сохраните полученный токен. 

> [!NOTE]
> Значение токена аутентификации нельзя просмотреть позже. Оно доступно только сразу после создания токена. Если вы потеряете сохраненный токен, вам придется сгенерировать его заново.
</details>

Склонируйте репозиторий:
```bash
git clone https://github.com/marginalex2001/zbx_send_data.git
```
Переименуйте файл `.env.template` в `.env`, и установите значения переменных:
`API_TOKEN` - Токен созданный ранее
`ZABBIX_URL` - Адрес сервера заббикс. Указывается полный путь до сервера, с указанием порта. *Пример: `127.0.0.1:8000/zabbix`*
`TABLE_NAME` - Имя таблицы `.xlsx` из которой берутся данные для работы. По умолчанию указана таблица *hosts.xslx*. Описание полей таблицы можно посмотреть в файле [table.md](./table.md)

Загрузите окружение pipenv:
```bash
pipenv sync
```
#### Для запуска используйте:
- если окружение pipenv не активировано:
    ```bash
    pipenv run ./main.py
    ```
- если окружение pipenv активировано:
    ```bash
    python ./main.py
    ```


## Описание класса `ZabbixAddHost`:
**Принимает следующие аргументы:**
`api_token` - Токен для подключения к заббикс серверу (обязательный параметр)
`api_url` - IP адрес заббикс сервера (обязательный параметр)
`tablename` - Имя таблицы используемой для чтения/записи хостов (опциональный параметр, по умолчанию используется имя *hosts.xlsx*)
`table` - Датафрейм pandas с данными из таблицы (опциональныый параметр, если не задан, будет создан файл с именем указаным в `tablename`)

При вызове инициализирует подключение к заббикс серверу и создает файл таблицы, если еще не создан.

### Метод `get_hosts()`:
Позволяет получить список хостов уже добавленных в заббикс через API.
### Метод `create_hosts()`:
Создает хосты по [данным из таблицы](./table.md).
